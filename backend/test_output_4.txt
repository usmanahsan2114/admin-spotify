
> backend@1.0.0 test
> cross-env NODE_ENV=test jest

  console.log
    [dotenv@17.2.3] injecting env (11) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    [dotenv@17.2.3] injecting env (11) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    âœ… Environment variables validated successfully (DB_DIALECT: postgres)

      at log (middleware/envValidation.js:85:11)

[33mwarn[39m: [VALIDATION] Validation failed for /api/login: {"0":{"field":"body.password","message":"Invalid input: expected string, received undefined"},"service":"shopify-admin-api","timestamp":"2025-11-23T08:20:16.792Z"}
[33mwarn[39m: [LOGIN] User not found: wrong@example.com (normalized: wrong@example.com) {"service":"shopify-admin-api","timestamp":"2025-11-23T08:20:16.804Z"}
[33mwarn[39m: [LOGIN] Password mismatch for: test@example.com {"service":"shopify-admin-api","timestamp":"2025-11-23T08:20:16.810Z"}
PASS tests/authController.test.js
  Auth Controller
    POST /api/login
      âˆš should return 400 if email or password missing (54 ms)
      âˆš should return 401 if user not found (6 ms)
      âˆš should return 401 if password invalid (6 ms)
      âˆš should return tokens on successful login (7 ms)

  console.log
    âœ… Environment variables validated successfully (DB_DIALECT: postgres)

      at log (middleware/envValidation.js:85:11)

[31merror[39m: [ERROR] /api/stores POST: Store.findOne is not a function {"service":"shopify-admin-api","stack":"TypeError: Store.findOne is not a function\n    at findOne (C:\\Apex IT Solutions\\apex dashboard\\admin-spotify\\backend\\controllers\\storeController.js:112:43)\n    at Layer.handleRequest (C:\\Apex IT Solutions\\apex dashboard\\admin-spotify\\backend\\node_modules\\router\\lib\\layer.js:152:17)\n    at next (C:\\Apex IT Solutions\\apex dashboard\\admin-spotify\\backend\\node_modules\\router\\lib\\route.js:157:13)\n    at next (C:\\Apex IT Solutions\\apex dashboard\\admin-spotify\\backend\\middleware\\validateRequest.js:12:9)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)","timestamp":"2025-11-23T08:20:16.904Z"}
FAIL tests/storeController.test.js
  Store Controller
    GET /api/stores
      âˆš should return all stores (29 ms)
    POST /api/stores
      Ã— should create a new store (21 ms)

  â— Store Controller â€º POST /api/stores â€º should create a new store

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

    [0m [90m 77 |[39m                 [33m.[39msend(newStoreData)[33m;[39m
     [90m 78 |[39m
    [31m[1m>[22m[39m[90m 79 |[39m             expect(res[33m.[39mstatusCode)[33m.[39mtoBe([35m201[39m)[33m;[39m
     [90m    |[39m                                    [31m[1m^[22m[39m
     [90m 80 |[39m             expect(res[33m.[39mbody[33m.[39mstore)[33m.[39mtoEqual(createdStore)[33m;[39m
     [90m 81 |[39m             expect(res[33m.[39mbody[33m.[39madminCredentials)[33m.[39mtoBeDefined()[33m;[39m
     [90m 82 |[39m         })[33m;[39m[0m

      at Object.toBe (tests/storeController.test.js:79:36)

Test Suites: 1 failed, 1 passed, 2 total
Tests:       1 failed, 5 passed, 6 total
Snapshots:   0 total
Time:        1.844 s, estimated 2 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
